---
timestamp: 'Sun Oct 19 2025 02:02:44 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251019_020244.d2b59b84.md]]'
content_id: 6450d4074441a3c8708fc688c784f61b55d4d9d36e51d97eb8f2ec428a2a4a07
---

# question are there any updates i should make to

#### 1) UserIdentity

```concept
concept UserIdentity
purpose manage the core, unique identity and basic profile information for individuals interacting with the system.
principle new user identities can be created, storing their unique email and display name.

state
a set of Users with
  a email String
  a name String

actions
createUser (email: String, name: String): (user: User) or (error: String)
  requires email is unique
  effects a new User entity is created with the given email and name, and its opaque ID is returned.

updateUserName (user: User, newName: String): Empty or (error: String)
  requires user exists
  effects updates the name for the specified User.

updateUserEmail (user: User, newEmail: String): Empty or (error: String)
  requires user exists and newEmail is unique
  effects updates the email for the specified User.
```

***

#### 2) UserAuthentication `[User]`

```concept
concept UserAuthentication [User]
purpose allow users to securely register, log in, and manage their credentials.
principle a user can register with a unique username and password, log in to establish a session, and log out to end it.

state
a set of AuthenticatedUsers with
  a user User
  a username String
  a passwordHash String
  an optional sessionID String
  an optional canvasOAuthToken String // To store Canvas connection token

actions
register (user: User, username: String, password: String): Empty or (error: String)
  requires username is unique and password meets complexity requirements
  effects creates a new AuthenticatedUser, associating the provided User ID with a username and hashed password.

login (username: String, password: String): (sessionID: String, user: User) or (error: String)
  requires username and password match an existing AuthenticatedUser
  effects generates a new sessionID for the AuthenticatedUser.

logout (sessionID: String): Empty or (error: String)
  requires sessionID is valid
  effects clears the sessionID for the associated AuthenticatedUser.

changePassword (user: User, oldPassword: String, newPassword: String): Empty or (error: String)
  requires user exists, oldPassword matches, newPassword meets complexity requirements
  effects updates the passwordHash for the specified User.

connectCanvas (user: User, canvasOAuthToken: String): Empty or (error: String)
  requires user exists and canvasOAuthToken is valid
  effects stores or updates the Canvas OAuth token for the user, enabling Canvas data fetching.

disconnectCanvas (user: User): Empty or (error: String)
  requires user exists and has an existing canvasOAuthToken
  effects clears the Canvas OAuth token for the user.
```

***

#### 3) CourseManagement `[User]`

```concept
concept CourseManagement [User]
purpose organize and categorize academic deadlines by associating them with specific courses.
principle each user can define courses, assign unique identifiers, and manage course-specific details including an optional link to an external Canvas course.

state
a set of Courses with
  a creator User
  a courseCode String
  a title String
  an optional canvasId String

actions
createCourse (creator: User, courseCode: String, title: String): (course: Course) or (error: String)
  requires courseCode is unique for the creator
  effects creates a new Course entity with the given details, linked to the creator.

updateCourse (course: Course, newCourseCode: String, newTitle: String): Empty or (error: String)
  requires course exists and newCourseCode is unique for its creator (if changed)
  effects updates the courseCode and title of an existing course.

setCanvasId (course: Course, canvasId: String): Empty or (error: String)
  requires course exists and canvasId is unique across all courses
  effects sets or updates the external Canvas ID for the specified course.

deleteCourse (course: Course): Empty or (error: String)
  requires course exists and has no associated deadlines (this external check would be via syncs)
  effects removes the specified course entity.
```

***

#### 4) DeadlineManagement `[User, Course]`

```concept
concept DeadlineManagement [User, Course]
purpose store and manage academic deadlines, tracking their status and association with courses.
principle each deadline has a due date, title, status, and is explicitly linked to a course and the user who added it.

state
a set of Deadlines with
  a course Course
  a title String
  a due DateTime
  a source of SYLLABUS or CANVAS or WEBSITE or MANUAL or IMAGE or LLM_PARSED
  a addedBy User
  an optional status of NOT_STARTED or IN_PROGRESS or DONE

actions
createDeadline (course: Course, title: String, due: DateTime, source: SYLLABUS or CANVAS or WEBSITE or MANUAL or IMAGE or LLM_PARSED, addedBy: User): (deadline: Deadline) or (error: String)
  requires course exists (this external check would be via syncs)
  effects creates a new Deadline entity with the given details.

updateDeadline (deadline: Deadline, newTitle: String, newDue: DateTime, newSource: SYLLABUS or CANVAS or WEBSITE or MANUAL or IMAGE or LLM_PARSED): Empty or (error: String)
  requires deadline exists
  effects updates the title, due date, and source of an existing deadline.

setStatus (deadline: Deadline, status: NOT_STARTED or IN_PROGRESS or DONE): Empty or (error: String)
  requires deadline exists
  effects updates the completion status of a deadline.

deleteDeadline (deadline: Deadline): Empty or (error: String)
  requires deadline exists
  effects removes the specified deadline.
```

***

#### 5) DocumentManagement `[User, Course]`

```concept
concept DocumentManagement [User, Course]
purpose securely store and manage various uploaded materials (e.g., syllabi, screenshots) and associate them with specific courses and users.
principle each document is uniquely identified, linked to its uploading user and associated course, and its core metadata is maintained.

state
a set of UploadedDocuments with
  a course Course
  a uploader User
  a fileName String
  a fileType String // e.g., "application/pdf", "image/png", "text/plain"
  a uploadTime DateTime
  a contentUrl String // URL where the actual file content is stored externally (e.g., GCS, S3)
  a processedTextContent String // Extracted text content from the file, suitable for LLM processing

actions
uploadDocument (course: Course, fileName: String, fileType: String, rawFileContent: String, uploader: User): (document: UploadedDocument, processedTextContent: String, contentUrl: String) or (error: String)
  requires course exists (external check via syncs) and rawFileContent is non-empty
  effects simulates storing the rawFileContent in external storage, records its contentUrl and metadata. Simulates text extraction. Returns document ID, extracted text content, and contentUrl for further processing by other concepts (via syncs).

updateDocumentMetadata (document: UploadedDocument, newFileName: String, newFileType: String): Empty or (error: String)
  requires document exists
  effects updates the fileName and fileType of an existing document's metadata.

getDocumentContent (document: UploadedDocument): (processedTextContent: String) or (error: String)
  requires document exists
  effects retrieves the stored processed text content of the specified document.

deleteDocument (document: UploadedDocument): Empty or (error: String)
  requires document exists
  effects removes the specified document's metadata from the concept state and simulates deletion of its content from external storage.
```

***

#### 6) SuggestionManagement `[User, Document, Course]`

```concept
concept SuggestionManagement [User, Document, Course]
purpose represent extracted deadline candidates from documents, images, web pages, or Canvas; optionally AI-augmented.
principle suggestions are produced via an LLM from uploaded files, web pages, or Canvas data; users confirm suggestions before they become official deadlines.

state
a set of ParsedDeadlineSuggestions with
  a user User // The user who initiated the parsing
  an optional document Document // ID of the UploadedDocument if applicable
  an optional canvasMetadata String // Raw JSON data from Canvas
  an optional websiteUrl String
  a title String
  a due DateTime
  a source of SYLLABUS or IMAGE or WEBSITE or CANVAS
  an optional confirmed Boolean = false
  an optional confidence Number (0.0–1.0)
  an optional extractionMethod of CANVAS_JSON or LLM
  an optional provenance String // e.g., LLM model version, prompt used, file name
  an optional warnings set of String // e.g., "date ambiguous", "low confidence"

a set of ExtractionConfigs with
  a name String
  a modelVersion String
  a basePromptTemplate String
  a maxTokens Number
  a temperature Number
  a timezone String
  an optional timeout Number

actions
createExtractionConfig (name: String, modelVersion: String, basePromptTemplate: String, maxTokens: Number, temperature: Number, timezone: String, optionalTimeout: Number): (config: ExtractionConfig) or (error: String)
  requires name is unique
  effects creates a new ExtractionConfig entity for LLM processing.

parseFromCanvas(user: User, canvasData: String, config: ExtractionConfig): (suggestions: List<ParsedDeadlineSuggestion>) or (error: String)
  requires config exists and canvasData is valid JSON
  effects parses assignment JSON data, creates suggestions linked to `user`.
           sets `extractionMethod = CANVAS_JSON`, `source = CANVAS`.

llmExtractFromDocument(user: User, documentId: Document, documentContent: String, config: ExtractionConfig): (suggestions: List<ParsedDeadlineSuggestion>) or (error: String)
  requires config exists, documentId exists (external check via syncs), documentContent is text or image suitable for LLM
  effects uses LLM to extract structured suggestions from document content, creates suggestions linked to `user`.
           sets `extractionMethod = LLM`, `confidence`, `provenance` (linking to `documentId`).

llmExtractFromMultipleDocuments(user: User, documentIds: List<Document>, combinedDocumentContent: String, config: ExtractionConfig): (suggestions: List<ParsedDeadlineSuggestion>) or (error: String)
  requires config exists, combinedDocumentContent is non-empty and suitable for LLM
  effects sends combined document contents to LLM in SINGLE request to enable cross-referencing, creates suggestions linked to `user`.
           sets `extractionMethod = LLM`, `confidence`, `provenance` with multi-source attribution (using `documentIds`).

llmExtractFromWebsite(user: User, url: String, websiteContent: String, config: ExtractionConfig): (suggestions: List<ParsedDeadlineSuggestion>) or (error: String)
  requires config exists, url is reachable, websiteContent is non-empty
  effects uses LLM to parse website content into deadline suggestions, creates suggestions linked to `user`.
           sets `extractionMethod = LLM`, `provenance`, `confidence`.

refineWithFeedback(suggestion: ParsedDeadlineSuggestion, feedback: String, config: ExtractionConfig): (suggestion: ParsedDeadlineSuggestion) or (error: String)
  requires suggestion exists, feedback is non-empty, config exists
  effects re-prompts LLM using user feedback to refine fields of the suggestion.
           updates title, due, warnings, or confidence. Returns the ID of the updated suggestion.

editSuggestion(suggestion: ParsedDeadlineSuggestion, newTitle: String, newDue: DateTime): Empty or (error: String)
  requires suggestion exists, newTitle is non-empty, newDue is valid
  effects updates suggestion title and due date.
           sets `warnings` to indicate manual editing.

updateSuggestionTitle(suggestion: ParsedDeadlineSuggestion, newTitle: String): Empty or (error: String)
  requires suggestion exists and newTitle is non-empty
  effects updates suggestion title.
           sets `warnings` to indicate manual editing.

updateSuggestionDate(suggestion: ParsedDeadlineSuggestion, newDue: DateTime): Empty or (error: String)
  requires suggestion exists and newDue is valid
  effects updates suggestion due date.
           sets `warnings` to indicate manual editing.

confirm (suggestion: ParsedDeadlineSuggestion, course: Course, addedBy: User): (course: Course, title: String, due: DateTime, source: SYLLABUS or IMAGE or WEBSITE or CANVAS or LLM_PARSED, addedBy: User) or (error: String)
  requires suggestion exists, is not already confirmed, has valid title and due date, and course exists (external check via syncs)
  effects marks suggestion as confirmed, and returns the data for creating a new Deadline in `DeadlineManagement`.
```

***

### Essential Synchronizations

```
sync parse_single_upload
when DocumentManagement.uploadDocument (document: d, processedTextContent: ptc, contentUrl: cu, course: crs, fileName: fn, fileType: ft, uploader: u)
where ft is "application/pdf" or "image/png" or "text/plain" // simplified check
then SuggestionManagement.llmExtractFromDocument (user: u, documentId: d, documentContent: ptc, config: default_llm_config) // Assuming 'default_llm_config' is an implicitly available config from ExtractionConfigs

sync parse_multiple_uploads // A new sync to handle combining multiple documents
when DocumentManagement.uploadDocument (document: d1, processedTextContent: ptc1, course: crs, uploader: u) AND
     DocumentManagement.uploadDocument (document: d2, processedTextContent: ptc2, course: crs, uploader: u) // Extend 'when' for N documents as needed
then SuggestionManagement.llmExtractFromMultipleDocuments (user: u, documentIds: [d1, d2], combinedDocumentContent: (ptc1 + "\n\n" + ptc2), config: default_llm_config)

sync parse_canvas_connect
when UserAuthentication.connectCanvas (user: u, canvasOAuthToken: token)
then SuggestionManagement.parseFromCanvas (user: u, canvasData: (fetched data), config: default_canvas_config) // fetched data would come from an external Canvas API call

sync confirm_suggestion
when SuggestionManagement.confirm (suggestion: s, course: c, addedBy: u) : (course: out_c, title: t, due: d, source: src, addedBy: out_u)
then DeadlineManagement.createDeadline (course: out_c, title: t, due: d, source: src, addedBy: out_u)

sync status_update
when Request.setStatus (deadline: dl, status: st)
then DeadlineManagement.setStatus (deadline: dl, status: st)
```

***

### A Brief Note

The six concepts work together to support DueStack’s core features while maintaining strong separation of concerns and modularity.

* **UserIdentity** manages fundamental user identities (email, name) and is purely about identity management. All actions (e.g., uploading documents, creating deadlines, updating status) are scoped by a `User` ID which originates from this concept. Update actions for user name and email have been added.
* **UserAuthentication** handles secure registration, login, and managing user credentials, including Canvas connection tokens, for existing `User` IDs from `UserIdentity`. It now includes a `disconnectCanvas` action for completeness.
* **CourseManagement** serves as containers for organizing deadlines and documents. Each course is tied to specific content and metadata, and allows both imports and manual additions. It includes full CRUD for courses and a dedicated `setCanvasId` action.
* **DeadlineManagement** is the primary planning unit in the app. Deadlines can come from Canvas imports, manual inputs, or confirmed document/image parsing. Status values help students track progress. It includes full CRUD for deadlines and `setStatus`.
* **DocumentManagement** securely stores and manages external syllabus files, GitHub tables, screenshots, and ties uploads to users and courses. It now distinguishes between `contentUrl` (for external storage) and `processedTextContent` (for LLM consumption), ensuring that large binary data is not stored in the database. Full CRUD actions for document metadata are now available.
* **SuggestionManagement** represents the result of OCR or parsing logic and must be confirmed by users before becoming official Deadlines. Canvas data also routes through this system to preserve the same confirmation pattern. Its actions have been refined to take primitive `string` content (e.g., `documentContent`, `combinedDocumentContent`) and `User` IDs, enforcing strict modularity. It also includes `ExtractionConfigs` and actions for refining and directly editing suggestions.

Generic parameters are resolved as:

* `User` always comes from the `UserIdentity` concept.
* `Course` in all references maps to `CourseManagement`.
* `Document` is an object from `DocumentManagement`.
* `SuggestionManagement.confirm` emits data for `DeadlineManagement.createDeadline` but doesn’t create the Deadline itself; this is handled by a synchronization.

based on these changes? In fact provide the entirely new corrected spec
